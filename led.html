<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Led Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .led-on {
            background-color: #fca5a5; /* Red-300 */
            color: #991b1b; /* Red-700 */
        }
        .led-off {
            background-color: #86efac; /* Green-300 */
            color: #166534; /* Green-700 */
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <header class="bg-blue-500 text-white flex items-center p-4">
        <h1 class="text-xl font-bold">Led Control</h1>
    </header>

    <main class="p-4 mb-16">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            <div class="bg-white shadow-md rounded-lg overflow-hidden">
                <img src="https://via.placeholder.com/150/ff0000" alt="dapur" class="w-full h-40 object-cover">
                <div class="p-4 text-center">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">LED DAPUR</h3>
                    <p class="text-lg font-bold text-gray-800 mb-2">Status : <span class="status" id="statusDapur">OFF</span></p>
                    <button class="w-full py-2 rounded-md led-off" onclick="toggleDapur()">Nyalakan</button>
                </div>
            </div>

            <div class="bg-white shadow-md rounded-lg overflow-hidden">
                <img src="https://via.placeholder.com/150/ff0000" alt="tamu" class="w-full h-40 object-cover">
                <div class="p-4 text-center">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">LED TAMU</h3>
                    <p class="text-lg font-bold text-gray-800 mb-2">Status : <span class="status" id="statusTamu">OFF</span></p>
                    <button class="w-full py-2 rounded-md led-off" onclick="toggleTamu()">Nyalakan</button>
                </div>
            </div>

            <div class="bg-white shadow-md rounded-lg overflow-hidden">
                <img src="https://via.placeholder.com/150/ff0000" alt="makan" class="w-full h-40 object-cover">
                <div class="p-4 text-center">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">LED MAKAN</h3>
                    <p class="text-lg font-bold text-gray-800 mb-2">Status : <span class="status" id="statusMakan">OFF</span></p>
                    <button class="w-full py-2 rounded-md led-off" onclick="toggleMakan()">Nyalakan</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        const endPoint = "http://192.168.186.139"; // Gantilah dengan IP ESP32 yang sesuai

    // Fungsi untuk toggle LED Dapur
function toggleDapur() {
    console.log("Toggling Dapur LED...");

    // Mengirimkan POST request untuk mengubah status LED Dapur
    fetch(`${endPoint}/dapur`, { method: "POST" })
        .then(response => response.text())
        .then(result => {
            console.log("Dapur LED response: ", result); // Debugging response
            // Panggil getStatus() untuk mendapatkan status terbaru setelah toggle
            getStatus();
        })
        .catch(error => {
            console.error("Error toggling Dapur LED: ", error); // Debugging error
        });
}

// Fungsi untuk toggle LED Tamu
function toggleTamu() {
    console.log("Toggling Tamu LED...");

    // Mengirimkan POST request untuk mengubah status LED Tamu
    fetch(`${endPoint}/tamu`, { method: "POST" })
        .then(response => response.text())
        .then(result => {
            console.log("Tamu LED response: ", result); // Debugging response
            // Panggil getStatus() untuk mendapatkan status terbaru setelah toggle
            getStatus();
        })
        .catch(error => {
            console.error("Error toggling Tamu LED: ", error); // Debugging error
        });
}

// Fungsi untuk toggle LED Makan
function toggleMakan() {
    console.log("Toggling Makan LED...");

    // Mengirimkan POST request untuk mengubah status LED Makan
    fetch(`${endPoint}/makan`, { method: "POST" })
        .then(response => response.text())
        .then(result => {
            console.log("Makan LED response: ", result); // Debugging response
            // Panggil getStatus() untuk mendapatkan status terbaru setelah toggle
            getStatus();
        })
        .catch(error => {
            console.error("Error toggling Makan LED: ", error); // Debugging error
        });
}

// Fungsi untuk mengambil status LED dari ESP32
function getStatus() {
    console.log("Fetching LED statuses...");

    // Ambil status LED Dapur
    fetch(`${endPoint}/dapur`)
        .then(response => response.text())
        .then(result => {
            updateStatus('Dapur', result); // Perbarui status LED Dapur
        });

    // Ambil status LED Tamu
    fetch(`${endPoint}/tamu`)
        .then(response => response.text())
        .then(result => {
            updateStatus('Tamu', result); // Perbarui status LED Tamu
        });

    // Ambil status LED Makan
    fetch(`${endPoint}/makan`)
        .then(response => response.text())
        .then(result => {
            updateStatus('Makan', result); // Perbarui status LED Makan
        });
}

// Fungsi untuk memperbarui status LED di halaman
function updateStatus(led, status) {
    console.log(`Updating status for ${led}: ${status}`);

    const statusElement = document.getElementById(`status${led}`);
    const button = document.querySelector(`button[onclick='toggle${led}()']`);
    const img = document.querySelector(`img[alt='${led.toLowerCase()}']`);

    if (status === "ON") {
        console.log(`${led} LED is ON`);
        statusElement.textContent = "ON";
        button.classList.remove("led-off");
        button.classList.add("led-on");
        button.textContent = "Matikan";
        img.src = "https://via.placeholder.com/150/00ff00"; // Ganti gambar dengan hijau (ON)
    } else {
        console.log(`${led} LED is OFF`);
        statusElement.textContent = "OFF";
        button.classList.remove("led-on");
        button.classList.add("led-off");
        button.textContent = "Nyalakan";
        img.src = "https://via.placeholder.com/150/ff0000"; // Ganti gambar dengan merah (OFF)
    }
}

// Panggil fungsi getStatus saat halaman dimuat
window.onload = getStatus;

    </script>
</body>
</html>
